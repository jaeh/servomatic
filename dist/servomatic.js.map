{"version":3,"sources":["../src/servomatic.js"],"names":[],"mappings":"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","file":"src/servomatic.js","sourcesContent":["import express from 'express';\nimport {get} from 'http';\nimport {join} from 'path';\nimport Favicon from 'magic-favicon';\nimport {existsSync} from 'fs';\nimport api from './lib/api';\nimport errorHandler from './lib/errorHandler';\nimport killer from './lib/killer';\nimport view from './lib/view';\nimport Logger from './lib/logger';\nimport minimist from 'minimist';\n\nvar servomatic = express()\n  , env   = servomatic.get('env')\n  , cwd   = process.cwd()\n  , argv  = minimist( process.argv.slice(2) )\n;\n\nif ( argv.dir && typeof argv.dir === 'string' ) {\n  if ( argv.dir.indexOf('/') === 0 ) {\n    cwd = argv.dir;\n  } else {\n    cwd = join( cwd, argv.dir );\n  }\n}\n\nvar dirs = {\n    static: join(cwd)\n  , public: join(cwd, 'public')\n  , views : join(cwd, 'views')\n  , favicon: join(cwd, 'favicon.ico')\n};\n\nconsole.log(`executing in cwd: ${cwd}`);\n\nservomatic.set('port', process.env.PORT || 80);\n\n// view engine setup for the rare cases where no html file exists\nservomatic.set('views', dirs.views);\nservomatic.set('view engine', 'jade');\n\nnew Favicon(servomatic, dirs.favicon);\n\n//if requested path exists in /public it gets served from there\nservomatic.use(express.static(dirs.public));\n\nnew Logger(servomatic);\n\n//servomaticomatic api redirect\nservomatic.use('/slackomatic/*', api);\n\nservomatic.use(killer);\n\nservomatic.use(\n  express.static( dirs.static, {\n      extensions: [\"html\"] //add html extension\n    , index: ['index.html'] //always load index.html files on /\n  } )\n);\n\n//renders :page from views/pages if static html does not exist\nservomatic.use('/:page', view);\n\n// catch 404 and forwarding to error handler\nservomatic.use( (req, res, next) => {\n  var err = new Error('Not Found');\n  err.status = 404;\n  next(err);\n});\n\n// error handlers\n// development error handler prints stacktrace\nif ( ! errorHandler.hasOwnProperty(env) ) {\n  env = 'production';\n}\nservomatic.use(errorHandler[env]);\n\nservomatic.listen(servomatic.get('port'), () => {\n  console.log(`servomatic listens on port : ${servomatic.get('port')}`);\n});\n"]}